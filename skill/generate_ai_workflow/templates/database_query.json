{
  "_meta": {
    "pattern": "database_query",
    "description": "数据库交互模式：输入 → LLM生成SQL → 数据库查询 → 表格转文本 → LLM分析 → 输出",
    "use_cases": ["Text转SQL", "数据库查询分析", "数据报表", "智能数据问答"],
    "source_example": "Text转SQL查询数据库并分析.json",
    "notes": "database_id 需要用户在 AI Power 平台上配置后手动填入。文本配置节点用于提供表结构信息。"
  },
  "edges": [
    {
      "sourceHandle": "NODE_INPUT_TEXT_01-1-input_text_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_01",
      "source": "NODE_INPUT_TEXT_01",
      "type": "ClosableEdge",
      "targetHandle": "NODE_LLM_SQL_01-in",
      "selected": false,
      "target": "NODE_LLM_SQL_01"
    },
    {
      "sourceHandle": "NODE_TEXT_EXTEND_01-1-set_text_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_02",
      "source": "NODE_TEXT_EXTEND_01",
      "type": "ClosableEdge",
      "targetHandle": "NODE_LLM_SQL_01-in",
      "selected": false,
      "target": "NODE_LLM_SQL_01"
    },
    {
      "sourceHandle": "NODE_LLM_SQL_01-1-llm_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_03",
      "source": "NODE_LLM_SQL_01",
      "type": "ClosableEdge",
      "targetHandle": "NODE_DB_LOADER_01-in",
      "selected": false,
      "target": "NODE_DB_LOADER_01"
    },
    {
      "sourceHandle": "NODE_LLM_SQL_01-1-llm_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_03B",
      "source": "NODE_LLM_SQL_01",
      "type": "ClosableEdge",
      "selected": false,
      "target": "NODE_OUTPUT_TEXT_SQL_01"
    },
    {
      "sourceHandle": "NODE_DB_LOADER_01-1-db_table_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_04",
      "source": "NODE_DB_LOADER_01",
      "type": "ClosableEdge",
      "selected": false,
      "target": "NODE_OUTPUT_TABLE_01"
    },
    {
      "sourceHandle": "NODE_DB_LOADER_01-1-db_table_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_05",
      "source": "NODE_DB_LOADER_01",
      "type": "ClosableEdge",
      "selected": false,
      "target": "NODE_TABLE_CONV_01"
    },
    {
      "sourceHandle": "NODE_TABLE_CONV_01-1-tableconvert_text_0",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_06",
      "source": "NODE_TABLE_CONV_01",
      "type": "ClosableEdge",
      "targetHandle": "NODE_LLM_ANALYZE_01-in",
      "selected": false,
      "target": "NODE_LLM_ANALYZE_01"
    },
    {
      "sourceHandle": "NODE_LLM_ANALYZE_01-1-llm_1",
      "data": { "weight": "1" },
      "markerEnd": { "color": "#9DA0B3", "width": 25, "type": "arrowclosed", "height": 10 },
      "animated": true,
      "style": { "strokeWidth": 2, "strokeLinejoin": "miter", "strokeDashoffset": 2, "stroke": "#9DA0B3", "strokeDasharray": 4 },
      "id": "EDGE_07",
      "source": "NODE_LLM_ANALYZE_01",
      "type": "ClosableEdge",
      "selected": false,
      "target": "NODE_OUTPUT_TEXT_01"
    }
  ],
  "inputsSchemas": [
    {
      "outputs": [{ "apiName": "input_text_0", "name": "input_text_0", "type": "TEXT" }],
      "inputs": [
        {
          "component": { "editableLabel": true, "runtime": true, "renderType": "variableInput", "props": { "autoSize": { "minRows": 1, "maxRows": 15 } } },
          "defaultValue": "",
          "name": "text",
          "label": "{{INPUT_LABEL}}",
          "type": "TEXT",
          "value": "",
          "required": true
        }
      ],
      "name": "input_text",
      "uuid": "NODE_INPUT_TEXT_01"
    }
  ],
  "nodes": [
    {
      "outputs": [{ "apiName": "input_text_0", "name": "input_text_0", "type": "TEXT" }],
      "functionName": "input_text",
      "inputs": [{ "name": "text", "label": "{{INPUT_LABEL}}", "value": "" }],
      "name": "input_text",
      "position": { "x": -200, "y": -80 },
      "title": "输入文本",
      "uuid": "NODE_INPUT_TEXT_01",
      "version": "1.1.0",
      "desc": "从网页端或者通过API接收用户输入的文本"
    },
    {
      "outputs": [{ "apiName": "set_text_0", "name": "set_text_0", "type": "TEXT" }],
      "functionName": "text_extend",
      "inputs": [{ "name": "text", "label": "配置的文本", "value": "{{TABLE_SCHEMA_DESCRIPTION}}" }],
      "name": "tool_text_extend",
      "position": { "x": -200, "y": 300 },
      "title": "文本配置",
      "uuid": "NODE_TEXT_EXTEND_01",
      "version": "1.0.0",
      "desc": "可以合并多个文本内容"
    },
    {
      "outputs": [{ "apiName": "llm_0", "name": "llm_0", "type": "TEXT" }],
      "functionName": "llm",
      "inputs": [
        { "name": "channel", "label": "厂商", "value": "azure" },
        { "name": "model", "label": "模型", "value": "gpt-5.2" },
        { "name": "temperature", "label": "创意程度", "value": 0 },
        { "name": "system", "label": "提示词Prompt（角色和要求）", "value": "# 角色\n你是一个SQL语言的专家，你擅长聆听用户的自然语言描述，来精准地生成SQL语句。\n\n## 能力\n1. 极强的自然语言理解能力。\n2. 专家级的SQL编程能力。\n3. 精通各类数据库，尤其是MySQL\n\n## 任务\n根据用户的<需求描述>，生成SQL查询语句。\n\n### 任务要求\n1. 只生成SQL查询语句\n2. 不要输出任何和SQL查询语句无关的内容或符号，不要输出SQL语句外部的包裹符```sql```\n\n### 参考内容\n{{set_text_0}}" },
        { "name": "user", "label": "提示词Prompt（内容和问题）", "value": "## 需求描述\n{{input_text_0}}" },
        { "name": "openAIKey", "label": "", "value": "" }
      ],
      "name": "ai_llm",
      "position": { "x": 270, "y": -85 },
      "title": "生成SQL",
      "uuid": "NODE_LLM_SQL_01",
      "version": "1.13.0",
      "desc": "大语言模型，根据Prompt输出内容"
    },
    {
      "outputs": [{ "apiName": "db_table_0", "name": "db_table_0", "type": "TABLE" }],
      "functionName": "db_loader",
      "inputs": [
        { "name": "database_id", "label": "选择数据库", "value": "" },
        { "name": "sql_statement", "label": "SQL语句", "value": "" }
      ],
      "name": "loader_db",
      "position": { "x": 690, "y": -80 },
      "title": "数据库数据获取",
      "uuid": "NODE_DB_LOADER_01",
      "version": "1.3.0",
      "desc": "获取数据库的数据，支持SQL语句"
    },
    {
      "outputs": [{ "apiName": "output_table_0", "name": "output_table_0", "type": "TABLE" }],
      "functionName": "output_table",
      "inputs": [
        { "name": "param_variable", "label": "表格", "value": "{{db_table_0}}" },
        { "name": "table", "label": "输出的表格", "value": "" }
      ],
      "name": "output_table",
      "position": { "x": 1120, "y": -120 },
      "title": "输出表格",
      "uuid": "NODE_OUTPUT_TABLE_01",
      "version": "1.0.0",
      "desc": "将表格数据从网页端或者通过API输出"
    },
    {
      "outputs": [{ "apiName": "tableconvert_text_0", "name": "tableconvert_text_0", "type": "TEXT" }],
      "functionName": "table_conversion",
      "inputs": [{ "name": "param_variable", "label": "表格", "value": "{{db_table_0}}" }],
      "name": "tool_table_conversion",
      "position": { "x": 690, "y": 270 },
      "title": "表格转文本",
      "uuid": "NODE_TABLE_CONV_01",
      "version": "1.0.0",
      "desc": "将数据库输出的表格转换成文本"
    },
    {
      "outputs": [{ "apiName": "llm_1", "name": "llm_1", "type": "TEXT" }],
      "functionName": "llm",
      "inputs": [
        { "name": "channel", "label": "厂商", "value": "{{LLM_CHANNEL}}" },
        { "name": "model", "label": "模型", "value": "{{LLM_MODEL}}" },
        { "name": "temperature", "label": "创意程度", "value": 0 },
        { "name": "system", "label": "提示词Prompt（角色和要求）", "value": "{{ANALYSIS_SYSTEM_PROMPT}}" },
        { "name": "user", "label": "提示词Prompt（内容和问题）", "value": "## 数据\n{{tableconvert_text_0}}" },
        { "name": "openAIKey", "label": "", "value": "" }
      ],
      "name": "ai_llm",
      "position": { "x": 1120, "y": 290 },
      "title": "数据分析",
      "uuid": "NODE_LLM_ANALYZE_01",
      "version": "1.13.0",
      "desc": "大语言模型，根据Prompt输出内容"
    },
    {
      "outputs": [{ "apiName": "output_text_0", "name": "output_text_0", "type": "TEXT" }],
      "functionName": "output_text",
      "inputs": [
        { "name": "param_variable", "label": "文本", "value": "{{llm_1}}" },
        { "name": "text", "label": "分析结果", "value": "" }
      ],
      "name": "output_text",
      "position": { "x": 1555, "y": 290 },
      "title": "输出文本",
      "uuid": "NODE_OUTPUT_TEXT_01",
      "version": "1.1.0",
      "desc": "将文本内容从网页端或者通过API输出"
    },
    {
      "outputs": [{ "apiName": "output_text_1", "name": "output_text_1", "type": "TEXT" }],
      "functionName": "output_text",
      "inputs": [
        { "name": "param_variable", "label": "文本", "value": "{{llm_0}}" },
        { "name": "text", "label": "生成的SQL", "value": "" }
      ],
      "name": "output_text",
      "position": { "x": 690, "y": 520 },
      "title": "输出SQL",
      "uuid": "NODE_OUTPUT_TEXT_SQL_01",
      "version": "1.1.0",
      "desc": "将文本内容从网页端或者通过API输出"
    }
  ],
  "outputsSchemas": [
    {
      "outputs": [{ "apiName": "output_table_0", "name": "output_table_0", "type": "TABLE" }],
      "inputs": [
        { "component": { "editableLabel": false, "renderType": "paramInput", "props": { "disabled": true, "readOnly": true } }, "defaultValue": "", "name": "param_variable", "label": "表格", "type": "TABLE", "value": "{{db_table_0}}", "required": false },
        { "component": { "editableLabel": true, "runtime": true, "renderType": "tableRender", "props": { "readOnly": true } }, "defaultValue": "", "name": "table", "label": "输出的表格", "type": "", "value": "", "required": false }
      ],
      "name": "output_table",
      "uuid": "NODE_OUTPUT_TABLE_01"
    },
    {
      "outputs": [{ "apiName": "output_text_0", "name": "output_text_0", "type": "TEXT" }],
      "inputs": [
        { "component": { "editableLabel": false, "renderType": "paramInput", "props": { "disabled": true, "readOnly": true, "placeholder": "可以使用{{变量名.子变量名}}的方式提取子变量" } }, "defaultValue": "", "name": "param_variable", "label": "文本", "type": "TEXT", "value": "{{llm_1}}", "required": false },
        { "component": { "editableLabel": true, "runtime": true, "renderType": "textInput", "props": { "autoSize": { "minRows": 1, "maxRows": 15 }, "readOnly": true } }, "defaultValue": "", "name": "text", "label": "分析结果", "type": "TEXT", "value": "", "required": false }
      ],
      "name": "output_text",
      "uuid": "NODE_OUTPUT_TEXT_01"
    },
    {
      "outputs": [{ "apiName": "output_text_1", "name": "output_text_1", "type": "TEXT" }],
      "inputs": [
        { "component": { "editableLabel": false, "renderType": "paramInput", "props": { "disabled": true, "readOnly": true, "placeholder": "可以使用{{变量名.子变量名}}的方式提取子变量" } }, "defaultValue": "", "name": "param_variable", "label": "文本", "type": "TEXT", "value": "{{llm_0}}", "required": false },
        { "component": { "editableLabel": true, "runtime": true, "renderType": "textInput", "props": { "autoSize": { "minRows": 1, "maxRows": 15 }, "readOnly": true } }, "defaultValue": "", "name": "text", "label": "生成的SQL", "type": "TEXT", "value": "", "required": false }
      ],
      "name": "output_text",
      "uuid": "NODE_OUTPUT_TEXT_SQL_01"
    }
  ]
}
